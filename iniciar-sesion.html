<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar Sesion | Gino Ostolaza</title>

  <link rel="icon" href="assets/img/branding/logo-favicon.png" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/login.css">
  <meta name="theme-color" content="#0a0e17">
</head>
<body>

<div class="login-page">

  <!-- Left: Branding panel -->
  <div class="login-branding">
    <div class="branding-content">
      <a href="index.html" class="branding-back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Volver al inicio
      </a>
      <img class="branding-logo" src="assets/img/branding/logo.png" alt="Logo Gino Ostolaza" width="120">
      <h1 class="branding-title">Area de Alumnos</h1>
      <p class="branding-desc">Accede a tu curso, estrategias de trading, mentoria y comunidad exclusiva.</p>
      <div class="branding-features">
        <div class="branding-feature">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          <span>Curso completo de trading</span>
        </div>
        <div class="branding-feature">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span>Comunidad exclusiva</span>
        </div>
        <div class="branding-feature">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span>Mentoria personalizada</span>
        </div>
      </div>
    </div>
    <div class="branding-glow"></div>
  </div>

  <!-- Right: Login form -->
  <div class="login-form-panel">
    <div class="login-form-container">

      <div class="form-header">
        <h2>Bienvenido de vuelta</h2>
        <p>Ingresa tus credenciales para acceder</p>
      </div>

      <form id="loginForm" role="form" novalidate aria-describedby="error-message">

        <div class="input-group">
          <label for="email">Correo electronico</label>
          <div class="input-wrapper">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6l-10 7L2 6"/></svg>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="tu@correo.com"
              required
              autocomplete="email"
              aria-required="true"
            >
          </div>
        </div>

        <div class="input-group">
          <label for="password">Contrasena</label>
          <div class="input-wrapper">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Tu contrasena"
              required
              autocomplete="current-password"
              aria-required="true"
            >
            <button type="button" class="toggle-password" aria-label="Mostrar contrasena" aria-pressed="false">
              <svg class="icon-eye" viewBox="0 0 24 24" aria-hidden="true">
                <path id="eye-shape" d="M12 5c-6.5 0-10 7-10 7s3.5 7 10 7 10-7 10-7-3.5-7-10-7z" fill="none" stroke="currentColor" stroke-width="2"/>
                <circle id="eye-pupil" cx="12" cy="12" r="3" fill="currentColor"/>
              </svg>
            </button>
          </div>
        </div>

        <div id="error-message" class="error-msg" role="alert" aria-live="polite" aria-atomic="true"></div>

        <button type="submit" class="btn-login" id="btnLogin">
          <span class="btn-text">Ingresar</span>
          <span class="btn-loader" style="display:none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
          </span>
        </button>

      </form>

      <div class="login-footer">
        <div class="secure-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span>Conexion segura SSL</span>
        </div>
        <p class="login-help">Problemas para acceder? <a href="https://instagram.com/ginoostolaza_" target="_blank" rel="noopener noreferrer">Contactar soporte</a></p>
      </div>

    </div>
  </div>

</div>

<!-- Error Modal -->
<div id="errorModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-bar"></div>
    <h3 id="errorTitle">Error</h3>
    <p id="errorMessage">Ocurrio un error.</p>
    <button onclick="closeErrorModal()">Cerrar</button>
  </div>
</div>

<script>
  // ============================================================
  // Login
  // ============================================================
  const loginForm = document.getElementById("loginForm");
  const errorMsg = document.getElementById("error-message");
  const btnLogin = document.getElementById("btnLogin");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMsg.textContent = "";
    errorMsg.classList.remove("visible");

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!email || !password) {
      errorMsg.textContent = "Por favor completa todos los campos.";
      errorMsg.classList.add("visible");
      return;
    }

    // Show loading state
    btnLogin.classList.add("loading");
    btnLogin.querySelector(".btn-text").style.display = "none";
    btnLogin.querySelector(".btn-loader").style.display = "inline-flex";

    // Credenciales de prueba para acceso rapido
    if (email === "email@email.com" && password === "contraseÃ±a") {
      sessionStorage.setItem("usuario", JSON.stringify({ nombre: "Usuario Demo", email: email }));
      sessionStorage.setItem("accesoAutorizado", "true");
      sessionStorage.setItem("timestampAcceso", Date.now().toString());
      window.location.href = "dashboard.html";
      return;
    }

    try {
      const response = await fetch("https://mi-backend-d4mv.onrender.com/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();

      if (response.ok && data.success) {
        sessionStorage.setItem("usuario", JSON.stringify(data.usuario));
        sessionStorage.setItem("accesoAutorizado", "true");
        sessionStorage.setItem("timestampAcceso", Date.now().toString());
        window.location.href = "dashboard.html";
      } else {
        errorMsg.textContent = data.message || "Email o contrasena incorrectos";
        errorMsg.classList.add("visible");
      }

    } catch (err) {
      console.error(err);
      errorMsg.textContent = "Error de conexion con el servidor.";
      errorMsg.classList.add("visible");
    } finally {
      btnLogin.classList.remove("loading");
      btnLogin.querySelector(".btn-text").style.display = "";
      btnLogin.querySelector(".btn-loader").style.display = "none";
    }
  });

  // ============================================================
  // Password toggle
  // ============================================================
  (function () {
    const $pwdInput = document.getElementById("password");
    const $pwdBtn = document.querySelector(".toggle-password");

    if ($pwdBtn && $pwdInput) {
      const syncEye = () => {
        const visible = $pwdInput.type === "text";
        $pwdBtn.classList.toggle("is-visible", visible);
        $pwdBtn.setAttribute("aria-pressed", visible ? "true" : "false");
        $pwdBtn.setAttribute("aria-label", visible ? "Ocultar contrasena" : "Mostrar contrasena");
      };

      $pwdBtn.addEventListener("click", () => {
        $pwdInput.type = $pwdInput.type === "password" ? "text" : "password";
        syncEye();
        $pwdInput.focus({ preventScroll: true });
      });

      syncEye();
    }
  })();

  // ============================================================
  // Error Modal
  // ============================================================
  function showErrorModal(message) {
    document.getElementById("errorMessage").textContent = message;
    document.getElementById("errorModal").style.display = "flex";
  }

  function closeErrorModal() {
    document.getElementById("errorModal").style.display = "none";
  }
</script>

</body>
</html>
