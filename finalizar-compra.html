<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Pago Seguro | Binary Edge Academy</title>

  <link rel="icon" href="assets/img/branding/logo-favicon.png" type="image/png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="assets/css/checkout.css">
  <link rel="stylesheet" href="assets/css/footer.css">

  <meta name="description" content="Pago seguro para acceder a la comunidad de trading de Binary Edge Academy.">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Pago Seguro | Binary Edge Academy">
  <meta property="og:image" content="assets/img/branding/logo.png">
  <meta name="theme-color" content="#0a0e17">
</head>
<body>

<!-- ============================================================
     TOP BAR
     ============================================================ -->
<header class="checkout-topbar">
  <div class="topbar-left">
    <img class="topbar-logo" src="assets/img/branding/logo-favicon.png" alt="Logo" width="36" height="36">
    <span class="topbar-brand">Binary Edge Academy</span>
    <span class="topbar-secure">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      Pago seguro
    </span>
  </div>
  <a href="index.html" class="topbar-back">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    Volver
  </a>
</header>

<!-- ============================================================
     MAIN CHECKOUT LAYOUT
     ============================================================ -->
<div class="checkout-wrapper">

  <!-- LEFT: Payment Methods -->
  <div class="checkout-main">

    <div>
      <div class="checkout-steps">
        <div class="step completed">
          <span class="step-number">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg>
          </span>
          <span>Elegir plan</span>
        </div>
        <div class="step-line done"></div>
        <div class="step active">
          <span class="step-number">2</span>
          <span>Metodo de pago</span>
        </div>
        <div class="step-line"></div>
        <div class="step">
          <span class="step-number">3</span>
          <span>Confirmacion</span>
        </div>
      </div>
      <h1 class="checkout-title">Elegir moneda y metodo de pago</h1>
      <p class="checkout-subtitle">Selecciona en que moneda queres pagar y elegÃ­ el metodo</p>
    </div>

    <!-- Currency Toggle -->
    <div>
      <h2 class="payment-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        Moneda de pago
      </h2>
      <div class="currency-toggle" id="currency-toggle">
        <button class="currency-btn active" data-currency="ars" id="btn-ars">
          <span class="currency-flag">ðŸ‡¦ðŸ‡·</span> Pesos (ARS)
        </button>
        <button class="currency-btn" data-currency="usd" id="btn-usd">
          <span class="currency-flag">ðŸ‡ºðŸ‡¸</span> Dolares (USD)
        </button>
      </div>
    </div>

    <!-- Login required notice (shown if not logged in) -->
    <div class="login-required" id="login-notice" style="display:none;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
      <p>Para pagar con pasarela automatica, necesitas <a href="iniciar-sesion.html">iniciar sesion</a>. Si no tenes cuenta, <a href="iniciar-sesion.html">registrate gratis</a>.</p>
    </div>

    <!-- Payment Methods -->
    <div>
      <h2 class="payment-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
        Pago automatico
      </h2>

      <div class="payment-methods">

        <!-- MercadoPago (ARS) -->
        <div class="payment-method" data-method="mercadopago" id="method-mp">
          <div class="payment-method-header">
            <div class="payment-radio"><div class="payment-radio-inner"></div></div>
            <div class="payment-method-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
            </div>
            <div class="payment-method-info">
              <div class="payment-method-name">MercadoPago</div>
              <div class="payment-method-desc">Tarjeta, transferencia, efectivo â€” en pesos argentinos</div>
            </div>
            <span class="payment-method-badge">Automatico</span>
          </div>
          <div class="payment-details">
            <div class="payment-details-inner">
              <div class="detail-note">
                Seras redirigido a MercadoPago para completar el pago de forma segura. Una vez aprobado, tu acceso se habilita automaticamente.
              </div>
              <button class="btn-pay btn-pay-mp" id="btn-pay-mp" type="button">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                Pagar con MercadoPago â€” <span id="mp-price">$9.999 ARS</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Stripe (USD) -->
        <div class="payment-method" data-method="stripe" id="method-stripe" style="display:none;">
          <div class="payment-method-header">
            <div class="payment-radio"><div class="payment-radio-inner"></div></div>
            <div class="payment-method-icon intl">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
            </div>
            <div class="payment-method-info">
              <div class="payment-method-name">Stripe (Tarjeta internacional)</div>
              <div class="payment-method-desc">Visa, Mastercard, AMEX â€” en dolares</div>
            </div>
            <span class="payment-method-badge">Automatico</span>
          </div>
          <div class="payment-details">
            <div class="payment-details-inner">
              <div class="detail-note">
                Seras redirigido a Stripe para completar el pago con tarjeta internacional. Una vez aprobado, tu acceso se habilita automaticamente.
              </div>
              <button class="btn-pay btn-pay-stripe" id="btn-pay-stripe" type="button">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                Pagar con tarjeta â€” <span id="stripe-price">USD 10,00</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="payment-or">o paga manualmente</div>

    <!-- Manual Payment Methods -->
    <div>
      <h2 class="payment-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Pago manual (con comprobante)
      </h2>

      <div class="note-card">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
        <p>
          Al realizar tu pago manual, envia un mensaje con:
          <em id="nota-mensaje">"Hola, les envio el pago de la Fase 1. Mi nombre es: [Tu nombre]"</em>
        </p>
      </div>

      <div class="payment-methods" style="margin-top: 0.75rem;">

        <!-- Banco Argentino -->
        <div class="payment-method" data-method="banco" id="method-banco">
          <div class="payment-method-header">
            <div class="payment-radio"><div class="payment-radio-inner"></div></div>
            <div class="payment-method-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M3 10h18M5 6l7-3 7 3M4 10v11M20 10v11M8 14v3M12 14v3M16 14v3"/></svg>
            </div>
            <div class="payment-method-info">
              <div class="payment-method-name">Transferencia bancaria (ARS/USD)</div>
              <div class="payment-method-desc">Banco Galicia o Mercado Pago</div>
            </div>
            <span class="payment-method-badge">Argentina</span>
          </div>
          <div class="payment-details">
            <div class="payment-details-inner">

              <div class="detail-block">
                <div class="detail-block-title">Banco Galicia â€” Cuenta en dolares</div>
                <div class="detail-row">
                  <span class="detail-label">Alias</span>
                  <span class="detail-value">GINO.OSTOLAZA.GON</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Titular</span>
                  <span class="detail-value">Gonzalez Binary Edge Academy</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">CBU</span>
                  <span class="detail-value">0070100230004026120398</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">CUIT</span>
                  <span class="detail-value">20-48637004-2</span>
                </div>
              </div>

              <div class="payment-divider"></div>

              <div class="detail-block">
                <div class="detail-block-title">Mercado Pago â€” Cuenta en pesos</div>
                <div class="detail-row">
                  <span class="detail-label">Alias</span>
                  <span class="detail-value">gino.ostolaza</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Titular</span>
                  <span class="detail-value">Binary Edge Academy Gonzalez</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">CVU</span>
                  <span class="detail-value">0000003100052857370471</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">CUIT</span>
                  <span class="detail-value">20-48637004-2</span>
                </div>
              </div>

              <div class="ars-conversion" id="conversion-banco">
                Equivalente en pesos: <strong class="resultado-transferencia">Cargando...</strong> ARS
              </div>

              <div class="detail-note">
                Podes usar la cuenta en dolares o Mercado Pago en pesos. Una vez hecho el pago, envia el comprobante por Instagram.
              </div>
            </div>
          </div>
        </div>

        <!-- Cripto -->
        <div class="payment-method" data-method="cripto" id="method-cripto">
          <div class="payment-method-header">
            <div class="payment-radio"><div class="payment-radio-inner"></div></div>
            <div class="payment-method-icon cripto">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-6.083-1.072m6.083 1.072.347-1.971m-1.562 8.864-6.083-1.072m7.645-7.893L5.514 9.204m7.645 7.892 1.043-5.922M5.86 18.047l1.043-5.922m0 0-1.389-7.921"/></svg>
            </div>
            <div class="payment-method-info">
              <div class="payment-method-name">Criptomonedas</div>
              <div class="payment-method-desc">Bitcoin, Ethereum o USDT</div>
            </div>
            <span class="payment-method-badge">Global</span>
          </div>
          <div class="payment-details">
            <div class="payment-details-inner">

              <div class="detail-block">
                <div class="detail-block-title">Redes aceptadas</div>
                <div class="detail-row">
                  <span class="detail-label">Bitcoin</span>
                  <span class="detail-value">BTC Network</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Ethereum</span>
                  <span class="detail-value">ERC-20</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">USDT</span>
                  <span class="detail-value">TRC-20 / ERC-20</span>
                </div>
              </div>

              <div class="detail-note">
                Las direcciones de wallet se comparten exclusivamente por mensaje privado para proteger ambas partes.
              </div>

              <div class="detail-block">
                <p style="font-size: 0.85rem; color: var(--color-text-muted);">
                  Solicita la wallet por Instagram:
                  <a href="https://instagram.com/ginoostolaza_" target="_blank" rel="noopener noreferrer" class="detail-link">@ginoostolaza_</a>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Internacional -->
        <div class="payment-method" data-method="intl" id="method-intl">
          <div class="payment-method-header">
            <div class="payment-radio"><div class="payment-radio-inner"></div></div>
            <div class="payment-method-icon intl">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            </div>
            <div class="payment-method-info">
              <div class="payment-method-name">PayPal / Skrill (USD)</div>
              <div class="payment-method-desc">Pago internacional manual</div>
            </div>
            <span class="payment-method-badge">Internacional</span>
          </div>
          <div class="payment-details">
            <div class="payment-details-inner">

              <div class="detail-block">
                <div class="detail-block-title">PayPal</div>
                <div class="detail-row">
                  <span class="detail-label">Link de pago</span>
                  <a href="https://paypal.me/GinoOstolaza/" target="_blank" rel="noopener noreferrer" class="detail-link">paypal.me/GinoOstolaza</a>
                </div>
                <p style="font-size:0.8rem;color:var(--color-text-dim);margin-top:0.3rem;">Coloca tu nombre completo en las notas del pago.</p>
              </div>

              <div class="payment-divider"></div>

              <div class="detail-block">
                <div class="detail-block-title">Skrill</div>
                <div class="detail-row">
                  <span class="detail-label">Email</span>
                  <span class="detail-value">ginitoostolaza1@gmail.com</span>
                </div>
                <p style="font-size:0.8rem;color:var(--color-text-dim);margin-top:0.3rem;">Indica tu nombre completo en el campo de mensaje.</p>
              </div>

              <div class="detail-note">
                Para confirmar tu pago o ante cualquier duda, contactanos por Instagram.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Trust badges -->
    <div class="trust-badges">
      <div class="trust-badge">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        Datos protegidos
      </div>
      <div class="trust-badge">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        Pago verificado
      </div>
      <div class="trust-badge">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4 12 14.01l-3-3"/></svg>
        Acceso inmediato
      </div>
    </div>

  </div>

  <!-- RIGHT: Order Summary Sidebar -->
  <aside class="checkout-sidebar">

    <div class="order-summary">
      <h2 class="summary-title">Resumen del pedido</h2>

      <div class="summary-product" id="summary-product">
        <div class="summary-product-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        </div>
        <div class="summary-product-info">
          <div class="summary-product-name" id="summary-name">Fase 1 â€” Comunidad de Trading</div>
          <div class="summary-product-desc" id="summary-desc">Acceso completo al curso + comunidad</div>
        </div>
      </div>

      <div class="summary-row">
        <span class="summary-label">Subtotal</span>
        <span class="summary-value" id="summary-subtotal">$9.999 ARS</span>
      </div>
      <div class="summary-row">
        <span class="summary-label">Comision</span>
        <span class="summary-value" style="color: var(--color-success);">$0,00</span>
      </div>

      <div class="summary-divider"></div>

      <div class="summary-total">
        <span class="summary-total-label">Total</span>
        <span class="summary-total-value" id="summary-total">$9.999 ARS</span>
      </div>

      <div class="summary-divider"></div>

      <ul class="summary-benefits" id="summary-benefits">
        <li>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
          2 sistemas de trading probados
        </li>
        <li>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
          Desarrollo personal y psicotrading
        </li>
        <li>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
          Acceso a comunidad exclusiva
        </li>
        <li>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
          Acceso se habilita al instante
        </li>
      </ul>
    </div>

    <!-- Dolar Blue -->
    <div class="dolar-card">
      <div class="dolar-card-title">Cotizacion de referencia</div>
      <div class="dolar-card-value" id="dolar-blue">Consultando dolar blue...</div>
      <div class="dolar-card-note">Referencia: dolar blue (venta)</div>
    </div>

    <!-- Contact -->
    <div class="contact-card">
      <p>Ya pagaste o tenes dudas? Escribinos directamente.</p>
      <a href="https://instagram.com/ginoostolaza_" target="_blank" rel="noopener noreferrer" class="contact-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
        Contactar por Instagram
      </a>
    </div>

    <!-- Login -->
    <a href="iniciar-sesion.html" class="login-link" id="sidebar-login">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3"/></svg>
      Ya soy alumno â€” Iniciar sesion
    </a>

  </aside>
</div>

<div id="footer"></div>
<script src="assets/js/footer.js"></script>

<!-- Supabase (to check login state) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/supabase-config.js"></script>
<script src="assets/js/auth.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // --- Detect plan from URL ---
    const params = new URLSearchParams(window.location.search);
    const plan = params.get('plan') || 'fase1';
    const isBot = plan === 'bot';

    // --- Pricing ---
    const PRICES = {
      fase1: { ars: 9999, usd: 10 },
      bot:   { ars: 7500, usd: 5 }
    };
    const prices = PRICES[plan] || PRICES.fase1;
    let currentCurrency = 'ars';

    // --- Check if user is logged in ---
    Auth.init();
    let userData = null;
    const storedUser = sessionStorage.getItem('usuario');
    const isLoggedIn = sessionStorage.getItem('accesoAutorizado') === 'true' && storedUser;

    if (isLoggedIn) {
      userData = JSON.parse(storedUser);
      document.getElementById('login-notice').style.display = 'none';
      document.getElementById('sidebar-login').style.display = 'none';
    } else {
      document.getElementById('login-notice').style.display = 'flex';
    }

    // --- Update product info based on plan ---
    if (isBot) {
      document.getElementById('summary-name').textContent = 'Bot de Trading â€” Suscripcion Mensual';
      document.getElementById('summary-desc').textContent = 'Bot automatizado configurado por Binary Edge';
      document.getElementById('nota-mensaje').textContent =
        '"Hola, les envio el pago del Bot de Trading. Mi nombre es: [Tu nombre]"';
      document.title = 'Bot de Trading | Pago Seguro';

      document.querySelector('.summary-product-icon').innerHTML =
        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1.07A7 7 0 0 1 14 23h-4a7 7 0 0 1-6.93-4H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"/><circle cx="9" cy="16" r="1" fill="currentColor"/><circle cx="15" cy="16" r="1" fill="currentColor"/></svg>';

      const benefits = document.getElementById('summary-benefits');
      benefits.innerHTML =
        '<li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>Opera automaticamente 24/7</li>' +
        '<li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>Configurado por nuestro equipo</li>' +
        '<li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>Actualizaciones incluidas</li>' +
        '<li><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>Acceso se habilita al instante</li>';
    }

    // --- Format helpers ---
    function fmtARS(n) { return '$' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + ' ARS'; }
    function fmtUSD(n) { return 'USD ' + n.toFixed(2).replace('.', ','); }

    // --- Update displayed prices ---
    function updatePrices() {
      const isARS = currentCurrency === 'ars';
      const priceStr = isARS ? fmtARS(prices.ars) : fmtUSD(prices.usd);

      document.getElementById('summary-subtotal').textContent = priceStr;
      document.getElementById('summary-total').textContent = priceStr;
      document.getElementById('mp-price').textContent = fmtARS(prices.ars);
      document.getElementById('stripe-price').textContent = fmtUSD(prices.usd);

      // Show/hide payment methods based on currency
      document.getElementById('method-mp').style.display = isARS ? 'block' : 'none';
      document.getElementById('method-stripe').style.display = isARS ? 'none' : 'block';

      // Deselect current method when currency changes
      document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
    }

    // --- Currency toggle ---
    document.querySelectorAll('.currency-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCurrency = btn.dataset.currency;
        updatePrices();
      });
    });

    // Initial price update
    updatePrices();

    // --- Payment method selection ---
    document.querySelectorAll('.payment-method').forEach(method => {
      method.addEventListener('click', () => {
        document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
        method.classList.add('selected');
      });
    });

    // --- MercadoPago payment ---
    document.getElementById('btn-pay-mp').addEventListener('click', async (e) => {
      e.stopPropagation();

      if (!isLoggedIn) {
        alert('Necesitas iniciar sesion para pagar. Registrate o ingresa con tu cuenta.');
        window.location.href = 'iniciar-sesion.html';
        return;
      }

      const btn = e.currentTarget;
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Procesando...';

      try {
        const response = await fetch('/api/mercadopago-create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            producto_id: plan,
            user_id: userData.id,
            user_email: userData.email,
            user_nombre: userData.nombre
          })
        });

        const data = await response.json();

        if (data.init_point) {
          window.location.href = data.init_point;
        } else {
          throw new Error(data.error || 'Error al procesar');
        }
      } catch (err) {
        console.error('MercadoPago error:', err);
        alert('Hubo un error al procesar el pago. Intenta de nuevo o usa otro metodo.');
        btn.disabled = false;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg> Pagar con MercadoPago â€” <span id="mp-price">' + fmtARS(prices.ars) + '</span>';
      }
    });

    // --- Stripe payment ---
    document.getElementById('btn-pay-stripe').addEventListener('click', async (e) => {
      e.stopPropagation();

      if (!isLoggedIn) {
        alert('Necesitas iniciar sesion para pagar. Registrate o ingresa con tu cuenta.');
        window.location.href = 'iniciar-sesion.html';
        return;
      }

      const btn = e.currentTarget;
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Procesando...';

      try {
        const response = await fetch('/api/stripe-create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            producto_id: plan,
            user_id: userData.id,
            user_email: userData.email,
            user_nombre: userData.nombre
          })
        });

        const data = await response.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error(data.error || 'Error al procesar');
        }
      } catch (err) {
        console.error('Stripe error:', err);
        alert('Hubo un error al procesar el pago. Intenta de nuevo o usa otro metodo.');
        btn.disabled = false;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg> Pagar con tarjeta â€” <span id="stripe-price">' + fmtUSD(prices.usd) + '</span>';
      }
    });

    // --- Dolar Blue API ---
    fetch("https://api.bluelytics.com.ar/v2/latest")
      .then(r => r.json())
      .then(data => {
        const dolarBlue = data.blue.value_sell;

        const dolarEl = document.getElementById("dolar-blue");
        if (dolarEl) {
          dolarEl.textContent = '$' + dolarBlue.toFixed(2) + ' ARS';
        }

        // Show ARS equivalent for bank transfer
        const resultado = prices.usd * dolarBlue;
        const fmt = (n) => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        document.querySelectorAll(".resultado-transferencia").forEach(span => {
          span.textContent = '$' + fmt(Math.round(resultado));
        });
      })
      .catch(() => {
        const dolarEl = document.getElementById("dolar-blue");
        if (dolarEl) dolarEl.textContent = "No disponible";
      });

    // --- Tab title ---
    document.addEventListener("visibilitychange", () => {
      if (document.hidden) {
        document.title = "Completar pago";
      } else {
        document.title = isBot ? "Bot de Trading | Pago Seguro" : "Pago Seguro | Binary Edge Academy";
      }
    });
  });
</script>

</body>
</html>
