<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar Sesi√≥n - Comunidad</title>

  <link rel="icon" href="assets/img/branding/logo-favicon.png" type="image/png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/login.css"/>
  <meta name="theme-color" content="#0d1117">

</head>
<body>

<!-- Bot√≥n de tema -->
<button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">
  <!-- Sol (light) -->
  <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <circle cx="12" cy="12" r="5"/>
    <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42M16.95 16.95l1.41 1.41M1 12h2m18 0h2M4.22 19.78l1.42-1.42M16.95 7.05l1.41-1.41"/>
  </svg>

  <!-- Luna (dark) -->
  <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
    <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
  </svg>
</button>

<div class="container" role="main" aria-label="Formulario de inicio de sesi√≥n">
  <h1>Iniciar sesi√≥n</h1>

  <form id="loginForm" role="form" novalidate aria-describedby="error-message">
    
    <!-- Email -->
    <div class="form-group">
      <label for="email">Correo electr√≥nico</label>
      <input
        type="email"
        id="email"
        name="email"
        placeholder="usuario@correo.com"
        required
        autocomplete="email"
        aria-required="true"
        aria-describedby="error-message"
      />
    </div>

    <!-- Contrase√±a -->
    <div class="form-group password-wrapper">
      <label for="password">Contrase√±a</label>
      <input
        type="password"
        id="password"
        name="password"
        placeholder="********"
        required
        autocomplete="current-password"
        aria-required="true"
        aria-describedby="error-message"
      />
      <button type="button" class="toggle-password" aria-label="Mostrar contrase√±a" aria-pressed="false">
  <!-- √çcono ojo minimalista con pupila animada (sin ‚Äúojo tachado‚Äù) -->
  <svg class="icon-eye" viewBox="0 0 24 24" aria-hidden="true">
    <!-- contorno del ojo -->
    <path id="eye-shape" d="M12 5c-6.5 0-10 7-10 7s3.5 7 10 7 10-7 10-7-3.5-7-10-7z" fill="none" stroke="currentColor" stroke-width="2" />
    <!-- pupila -->
    <circle id="eye-pupil" cx="12" cy="12" r="3" fill="currentColor" />
  </svg>
</button>

    </div>
    <!-- Bot√≥n de env√≠o -->
    <button type="submit" class="cta-button">Ingresar</button>

    <!-- Mensaje de error -->
    <div id="error-message" role="alert" aria-live="polite" aria-atomic="true"></div>
  </form>

    <!-- Modal de error personalizado -->
    <div id="errorModal" class="custom-modal">
    <div class="custom-modal-content">
        <div class="error-bar"></div>
        <h2 id="errorTitle">Error</h2>
        <p id="errorMessage">Ocurri√≥ un error.</p>
        <button onclick="closeErrorModal()">Cerrar</button>
    </div>
    </div>

    <!-- ===============================
    üîí Secci√≥n de Confianza Breve
    =============================== -->
    <section class="secure-section" aria-live="polite" aria-atomic="true">
    <h2>Seguridad</h2>
    <p>Tu informaci√≥n est√° protegida con <strong>cifrado SSL</strong> y conexiones seguras üîí</p>
    <p>No compartas tu contrase√±a con nadie y mant√©n tu cuenta segura.</p>
    </section>
</div>

<script>
  // ============================================================
  // Funcionalidad de inicio de sesi√≥n
  // ============================================================
  const loginForm = document.getElementById("loginForm");
  const errorMsg = document.getElementById("error-message");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault(); // Evita recargar la p√°gina
    errorMsg.textContent = ""; // Limpiamos mensajes previos

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!email || !password) {
      errorMsg.textContent = "Por favor completa todos los campos.";
      return;
    }

    try {
      const response = await fetch("https://mi-backend-d4mv.onrender.com/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await response.json();

      if (response.ok && data.success) {
        sessionStorage.setItem("usuario", JSON.stringify(data.usuario));
        sessionStorage.setItem("accesoAutorizado", "true");
        sessionStorage.setItem("timestampAcceso", Date.now().toString());
        window.location.href = "acceso-comunidad.html";
      } else {
        errorMsg.textContent = data.message || "Email o contrase√±a incorrectos";
      }

    } catch (err) {
      console.error(err);
      errorMsg.textContent = "Error de conexi√≥n con el servidor.";
    }
  });
</script>
<script>
  // ============================================================
  // Modo Oscuro / Claro + Mostrar/Ocultar Contrase√±a
  // ============================================================
  (function () {
    const $body = document.body;
    const $themeBtn = document.getElementById("theme-toggle");
    const $pwdInput = document.getElementById("password");
    const $pwdBtn = document.querySelector(".toggle-password");

    const saved = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

    if (saved === "dark" || (!saved && prefersDark)) {
      setTheme("dark");
    } else {
      setTheme("light");
    }

    function setTheme(mode) {
      const isDark = mode === "dark";
      $body.classList.toggle("dark", isDark);
      $body.classList.toggle("light", !isDark);

      if ($themeBtn) {
        $themeBtn.setAttribute("aria-pressed", isDark ? "true" : "false");
        $themeBtn.setAttribute("aria-label", isDark ? "Cambiar a modo claro" : "Cambiar a modo oscuro");
      }
    }

    if ($themeBtn) {
      $themeBtn.addEventListener("click", () => {
        const isDark = !$body.classList.contains("dark");
        setTheme(isDark ? "dark" : "light");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
    }

    if ($pwdBtn && $pwdInput) {
      const syncEye = () => {
        const visible = $pwdInput.type === "text";
        $pwdBtn.classList.toggle("is-visible", visible);
        $pwdBtn.setAttribute("aria-pressed", visible ? "true" : "false");
        $pwdBtn.setAttribute("aria-label", visible ? "Ocultar contrase√±a" : "Mostrar contrase√±a");
      };

      $pwdBtn.addEventListener("click", () => {
        $pwdInput.type = $pwdInput.type === "password" ? "text" : "password";
        syncEye();
        $pwdInput.focus({ preventScroll: true });
      });

      syncEye(); // Estado inicial
    }
  })();

  // ============================================================
  // Modal de Errores Personalizado
  // ============================================================
  function showErrorModal(message) {
    document.getElementById("errorMessage").textContent = message;
    document.getElementById("errorModal").style.display = "flex";
  }

  function closeErrorModal() {
    document.getElementById("errorModal").style.display = "none";
  }

  // ============================================================
  // Validaci√≥n extra (correo y contrase√±a antes de submit)
  // ============================================================
  const form = document.querySelector("form");
  if (form) {
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email) {
        showErrorModal("Debes ingresar tu correo electr√≥nico.");
        return;
      }
      if (!email.includes("@")) {
        showErrorModal("El correo electr√≥nico debe contener '@'.");
        return;
      }
      if (!password) {
        showErrorModal("Debes ingresar tu contrase√±a.");
        return;
      }

      this.submit(); // ‚úÖ Todo correcto
    });
  }
</script>

</body>
</html>
